layui.define(function(exports){var $=layui.jquery;(function($){var D=$(document).data("func",{});$.smartMenu=$.noop;$.fn.smartMenu=function(data,options){var B=$("body"),defaults={name:"",offsetX:2,offsetY:2,textLimit:6,beforeShow:$.noop,afterShow:$.noop};var params=$.extend(defaults,options||{});var htmlCreateMenu=function(datum){var dataMenu=datum||data,nameMenu=datum?Math.random().toString():params.name,htmlMenu="",htmlCorner="",clKey="smart_menu_";if($.isArray(dataMenu)&&dataMenu.length){htmlMenu='<div id="smartMenu_'+nameMenu+'" class="'+clKey+'box">'+'<div class="'+clKey+'body">'+'<ul class="'+clKey+'ul">';$.each(dataMenu,function(i,arr){if(i){htmlMenu=htmlMenu+'<li class="'+clKey+'li_separate">&nbsp;</li>'}if($.isArray(arr)){$.each(arr,function(j,obj){var text=obj.text,name=obj.name,icon=obj.icon||"",htmlMenuLi="",strTitle="",rand=Math.random().toString().replace(".","");if(icon){icon+="&nbsp;"}if(text){if(text.length>params.textLimit){text=text.slice(0,params.textLimit)+"â€¦";strTitle=' title="'+obj.text+'"'}if($.isArray(obj.child)&&obj.child.length){htmlMenuLi='<li class="layui-icon '+clKey+'li" data-hover="true">'+htmlCreateMenu(obj.child)+'<a href="javascript:" class="'+clKey+'a"'+strTitle+' data-name="'+name+'" data-key="'+rand+'"><i class="'+clKey+'triangle"></i>'+icon+text+"</a>"+"</li>"}else{htmlMenuLi='<li class="layui-icon '+clKey+'li">'+'<a href="javascript:" class="'+clKey+'a"'+strTitle+' data-name="'+name+'" data-key="'+rand+'">'+icon+text+"</a>"+"</li>"}htmlMenu+=htmlMenuLi;var objFunc=D.data("func");objFunc[rand]=obj.func;D.data("func",objFunc)}})}});htmlMenu=htmlMenu+"</ul>"+"</div>"+"</div>"}return htmlMenu},funSmartMenu=function(){var idKey="#smartMenu_",clKey="smart_menu_",jqueryMenu=$(idKey+params.name);if(!jqueryMenu.size()){$("body").append(htmlCreateMenu());$(idKey+params.name+" a").bind("click",function(){var key=$(this).attr("data-key"),name=$(this).attr("data-name");callback=D.data("func")[key];if($.isFunction(callback)){callback(name,D.data("trigger"))}$.smartMenu.hide();return false});$(idKey+params.name+" li").each(function(){var isHover=$(this).attr("data-hover"),clHover=clKey+"li_hover";$(this).hover(function(){var jqueryHover=$(this).siblings("."+clHover);jqueryHover.removeClass(clHover).children("."+clKey+"box").hide();jqueryHover.children("."+clKey+"a").removeClass(clKey+"a_hover");if(isHover){$(this).addClass(clHover).children("."+clKey+"box").show();$(this).children("."+clKey+"a").addClass(clKey+"a_hover")}})});return $(idKey+params.name)}return jqueryMenu};$(this).each(function(){this.oncontextmenu=function(e){if($.isFunction(params.beforeShow)){params.beforeShow.call(this)}e=e||window.event;e.cancelBubble=true;if(e.stopPropagation){e.stopPropagation()}$.smartMenu.hide();var st=D.scrollTop();var jqueryMenu=funSmartMenu();if(jqueryMenu){jqueryMenu.css({display:"block",left:e.clientX+params.offsetX,top:e.clientY+st+params.offsetY});D.data("target",jqueryMenu);D.data("trigger",this);if($.isFunction(params.afterShow)){params.afterShow.call(this)}return false}}});if(!B.data("bind")){B.bind("click",$.smartMenu.hide).data("bind",true)}};$.extend($.smartMenu,{hide:function(){var target=D.data("target");if(target&&target.css("display")==="block"){target.hide()}},remove:function(){var target=D.data("target");if(target){target.remove()}}})})($);var items={menu:[]};var menuData=[];var call={};var menu=function(){$(document).on("click",function(){$.smartMenu.hide()})};menu.prototype.init=function(options){config(options);layui.each(menuData,function(i){$(menuData[i].ele).smartMenu(menuData[i].data,{name:menuData[i].id})})};menu.prototype.on=function(events,callback){if(typeof callback==="function"){call[events]?call[events].push(callback):call[events]=[callback]}return this};function menuclick_callback(othis,name){call.menuclick?call.menuclick[0](othis,name):""}function config(options){$.extend(items,options);if(items&&items.menu.length){layui.each(items.menu,function(i){init(items.menu[i])})}}function init(item){var data=[];var groups=[];var prapare={};layui.each(item.items,function(i){item.items[i].func=menuclick_callback;var g=item.items[i].group||"default";if(!prapare[g]){prapare[g]=[];groups.push(g)}if(item.items[i].child){var cgroups=[];var cprapare=[];var cdata=[];layui.each(item.items[i].child,function(c){var ch=item.items[i].child[c];ch.func=menuclick_callback;var cg=ch.group||"cdefault";if(!cprapare[cg]){cprapare[cg]=[];cgroups.push(cg)}cprapare[cg].push(ch)});if(cgroups.length){layui.each(cgroups,function(g){cdata.push(cprapare[cgroups[g]])})}item.items[i].child=cdata}prapare[g].push(item.items[i])});if(groups.length){layui.each(groups,function(i){data.push(prapare[groups[i]])})}menuData.push({id:item.id,ele:item.ele,data:data})}var m=new menu();exports("menu",m)});